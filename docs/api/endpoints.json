{
  "openapi": "3.0.3",
  "info": {
    "title": "Einstore API",
    "version": "1.0.0",
    "description": "Refactor API (MVP)"
  },
  "servers": [
    {
      "url": "http://localhost:8080"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "AuthSession": {
        "type": "object",
        "properties": {
          "accessToken": {
            "type": "string"
          },
          "refreshToken": {
            "type": "string"
          },
          "expiresIn": {
            "type": "number"
          }
        }
      },
      "AuthRegisterResult": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string"
          },
          "session": {
            "$ref": "#/components/schemas/AuthSession"
          }
        }
      },
      "AuthLoginResult": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string"
          },
          "session": {
            "$ref": "#/components/schemas/AuthSession"
          }
        }
      },
      "AuthSessionInfo": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "nullable": true
          },
          "name": {
            "type": "string",
            "nullable": true
          },
          "avatarUrl": {
            "type": "string",
            "nullable": true
          },
          "status": {
            "type": "string"
          },
          "isSuperUser": {
            "type": "boolean"
          }
        }
      },
      "App": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "identifier": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Version": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "appId": {
            "type": "string"
          },
          "version": {
            "type": "string"
          }
        }
      },
      "Build": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "versionId": {
            "type": "string"
          },
          "buildNumber": {
            "type": "string"
          },
          "displayName": {
            "type": "string"
          },
          "storageKind": {
            "type": "string"
          },
          "storagePath": {
            "type": "string"
          },
          "sizeBytes": {
            "type": "number"
          }
        }
      },
      "Target": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "buildId": {
            "type": "string"
          },
          "platform": {
            "type": "string"
          },
          "role": {
            "type": "string"
          },
          "bundleId": {
            "type": "string"
          }
        }
      },
      "Variant": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "buildId": {
            "type": "string"
          },
          "kind": {
            "type": "string"
          },
          "key": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        }
      },
      "Module": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "buildId": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "onDemand": {
            "type": "boolean"
          }
        }
      },
      "Capability": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "targetId": {
            "type": "string"
          },
          "name": {
            "type": "string"
          }
        }
      },
      "ComplianceArtifact": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "buildId": {
            "type": "string"
          },
          "kind": {
            "type": "string"
          },
          "storageKind": {
            "type": "string"
          },
          "storagePath": {
            "type": "string"
          }
        }
      },
      "FeatureFlag": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "key": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "defaultEnabled": {
            "type": "boolean"
          },
          "metadata": {
            "type": "object",
            "nullable": true
          }
        }
      },
      "FeatureFlagOverride": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "flagId": {
            "type": "string"
          },
          "scope": {
            "type": "string"
          },
          "targetKey": {
            "type": "string",
            "nullable": true
          },
          "enabled": {
            "type": "boolean"
          },
          "rolloutPercentage": {
            "type": "integer",
            "nullable": true
          },
          "metadata": {
            "type": "object",
            "nullable": true
          }
        }
      },
      "Team": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "inboxBase": {
            "type": "string"
          },
          "planName": {
            "type": "string"
          },
          "planLimit": {
            "type": "integer"
          },
          "billingCurrency": {
            "type": "string",
            "nullable": true
          },
          "defaultCurrency": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string",
            "nullable": true
          },
          "timezone": {
            "type": "string",
            "nullable": true
          },
          "vatRegistered": {
            "type": "boolean"
          },
          "vatNumberRequired": {
            "type": "boolean"
          },
          "categoryRequired": {
            "type": "boolean"
          },
          "defaultExportPreset": {
            "type": "string"
          },
          "storageLimitBytes": {
            "type": "number",
            "nullable": true
          },
          "overviewStatsPeriod": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "TeamWithRole": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "inboxBase": {
            "type": "string"
          },
          "planName": {
            "type": "string"
          },
          "planLimit": {
            "type": "integer"
          },
          "billingCurrency": {
            "type": "string",
            "nullable": true
          },
          "defaultCurrency": {
            "type": "string",
            "nullable": true
          },
          "country": {
            "type": "string",
            "nullable": true
          },
          "timezone": {
            "type": "string",
            "nullable": true
          },
          "vatRegistered": {
            "type": "boolean"
          },
          "vatNumberRequired": {
            "type": "boolean"
          },
          "categoryRequired": {
            "type": "boolean"
          },
          "defaultExportPreset": {
            "type": "string"
          },
          "storageLimitBytes": {
            "type": "number",
            "nullable": true
          },
          "overviewStatsPeriod": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "memberRole": {
            "type": "string"
          }
        }
      },
      "TeamUser": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "nullable": true
          },
          "fullName": {
            "type": "string",
            "nullable": true
          },
          "name": {
            "type": "string",
            "nullable": true
          },
          "avatarUrl": {
            "type": "string",
            "nullable": true
          },
          "username": {
            "type": "string",
            "nullable": true
          },
          "role": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UserTeamSetting": {
        "type": "object",
        "properties": {
          "key": {
            "type": "string"
          },
          "value": {}
        }
      }
    },
    "parameters": {
      "TeamIdHeader": {
        "name": "x-team-id",
        "in": "header",
        "required": true,
        "schema": {
          "type": "string"
        },
        "description": "Active team context. Required for team-scoped endpoints."
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/info": {
      "get": {
        "summary": "Service info",
        "responses": {
          "200": {
            "description": "Info"
          }
        }
      }
    },
    "/badges": {
      "get": {
        "summary": "Badge counts",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Badges"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/ws": {
      "get": {
        "summary": "Realtime websocket",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "101": {
            "description": "Switching Protocols"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          },
          {
            "name": "accessToken",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Access token for websocket auth (browser fallback when Authorization header cannot be set)."
          },
          {
            "name": "teamId",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Team context for websocket auth (browser fallback when x-team-id header cannot be set)."
          }
        ]
      }
    },
    "/usage/storage/users": {
      "get": {
        "summary": "Storage usage by user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Usage"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/auth/register": {
      "post": {
        "summary": "Register user",
        "description": "Creates a personal team if the user has no team membership yet. The first registered user is marked as a super user.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  }
                },
                "required": [
                  "username",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Registered",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthRegisterResult"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login",
        "description": "Ensures a personal team exists for first-time logins.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "identifier": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "required": [
                  "identifier",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthLoginResult"
                }
              }
            }
          }
        }
      }
    },
    "/auth/refresh": {
      "post": {
        "summary": "Refresh token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refreshToken": {
                    "type": "string"
                  }
                },
                "required": [
                  "refreshToken"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session"
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "summary": "Logout",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "refreshToken": {
                    "type": "string"
                  }
                },
                "required": [
                  "refreshToken"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Revoked"
          }
        }
      }
    },
    "/auth/session": {
      "get": {
        "summary": "Get session",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Session",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthSessionInfo"
                }
              }
            }
          }
        }
      }
    },
    "/auth/password-reset": {
      "post": {
        "summary": "Request password reset",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string"
                  }
                },
                "required": [
                  "email"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sent"
          }
        }
      }
    },
    "/auth/password-reset/confirm": {
      "post": {
        "summary": "Confirm password reset",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string"
                  },
                  "newPassword": {
                    "type": "string"
                  }
                },
                "required": [
                  "token",
                  "newPassword"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reset"
          }
        }
      }
    },
    "/auth/oauth/{provider}/start": {
      "get": {
        "summary": "Start OAuth login",
        "requestBody": {
          "required": false
        },
        "responses": {
          "200": {
            "description": "OAuth start",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "authorizeUrl": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/auth/oauth/{provider}/callback": {
      "get": {
        "summary": "OAuth callback",
        "responses": {
          "302": {
            "description": "Redirect"
          }
        }
      }
    },
    "/auth/oauth/exchange": {
      "post": {
        "summary": "Exchange OAuth auth code",
        "description": "Creates a session and ensures a personal team exists for first-time logins. The first user is marked as a super user.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "authCode": {
                    "type": "string"
                  }
                },
                "required": [
                  "authCode"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session"
          }
        }
      }
    },
    "/apps": {
      "post": {
        "summary": "Create app",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/App"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List apps",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/apps/{id}": {
      "get": {
        "summary": "Get app",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "App"
          }
        }
      }
    },
    "/versions": {
      "post": {
        "summary": "Create version",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Version"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List versions",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/versions/{id}": {
      "get": {
        "summary": "Get version",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "Version"
          }
        }
      }
    },
    "/builds": {
      "post": {
        "summary": "Create build",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List builds",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/builds/{id}": {
      "get": {
        "summary": "Get build",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "Build"
          }
        }
      }
    },
    "/builds/{id}/metadata": {
      "get": {
        "summary": "Get build metadata",
        "description": "Returns build metadata with artifacts grouped by kind plus targets/app/version context.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "Build metadata"
          }
        }
      }
    },
    "/builds/{id}/downloads": {
      "post": {
        "summary": "Record build download",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      },
      "get": {
        "summary": "List build downloads",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/builds/{id}/installs": {
      "post": {
        "summary": "Record build install",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      },
      "get": {
        "summary": "List build installs",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/builds/{id}/ios/install-link": {
      "post": {
        "summary": "Create iOS install link",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ],
        "responses": {
          "200": {
            "description": "Install link"
          }
        }
      }
    },
    "/builds/{id}/ios/manifest": {
      "get": {
        "summary": "Get iOS manifest plist",
        "responses": {
          "200": {
            "description": "Manifest"
          }
        },
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "token",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ]
      }
    },
    "/builds/{id}/ios/download": {
      "get": {
        "summary": "Download iOS IPA",
        "responses": {
          "200": {
            "description": "Download"
          }
        },
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "token",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ]
      }
    },
    "/builds/{id}/ios/installs/track": {
      "post": {
        "summary": "Track iOS install",
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "token",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ]
      }
    },
    "/targets": {
      "post": {
        "summary": "Create target",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List targets",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/variants": {
      "post": {
        "summary": "Create variant",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List variants",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/modules": {
      "post": {
        "summary": "Create module",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List modules",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/capabilities": {
      "post": {
        "summary": "Create capability",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List capabilities",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/artifacts": {
      "post": {
        "summary": "Create compliance artifact",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "201": {
            "description": "Created"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "get": {
        "summary": "List compliance artifacts",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/feature-flags": {
      "post": {
        "summary": "Create or ensure feature flag",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "key": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "defaultEnabled": {
                    "type": "boolean"
                  },
                  "metadata": {
                    "type": "object"
                  }
                },
                "required": [
                  "key"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeatureFlag"
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List feature flags",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/FeatureFlag"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/feature-flags/{key}": {
      "get": {
        "summary": "Get feature flag by key",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Feature flag",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeatureFlag"
                }
              }
            }
          }
        }
      },
      "patch": {
        "summary": "Update feature flag",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "description": {
                    "type": "string",
                    "nullable": true
                  },
                  "defaultEnabled": {
                    "type": "boolean"
                  },
                  "metadata": {
                    "type": "object",
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeatureFlag"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete feature flag",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeatureFlag"
                }
              }
            }
          }
        }
      }
    },
    "/feature-flags/{key}/overrides": {
      "post": {
        "summary": "Create or update feature flag override",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "scope": {
                    "type": "string"
                  },
                  "targetKey": {
                    "type": "string",
                    "nullable": true
                  },
                  "enabled": {
                    "type": "boolean"
                  },
                  "rolloutPercentage": {
                    "type": "integer",
                    "nullable": true
                  },
                  "metadata": {
                    "type": "object"
                  }
                },
                "required": [
                  "scope",
                  "enabled"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/FeatureFlagOverride"
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List feature flag overrides",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/FeatureFlagOverride"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/feature-flags/{key}/evaluate": {
      "get": {
        "summary": "Evaluate feature flag",
        "description": "Super user only.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Evaluation result",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "key": {
                      "type": "string"
                    },
                    "enabled": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/ingest": {
      "post": {
        "summary": "Queue ingestion",
        "description": "iOS: extracts entitlements/provisioning profile and stores an entitlements artifact with distribution = adhoc | appstore | enterprise | none | broken. Returns 400 invalid_archive when the IPA/APK is not a valid zip archive.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "filePath": {
                    "type": "string"
                  },
                  "kind": {
                    "type": "string",
                    "enum": [
                      "ipa",
                      "apk",
                      "aab"
                    ]
                  }
                },
                "required": [
                  "filePath",
                  "kind"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Ingested",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    },
                    "result": {
                      "type": "object",
                      "properties": {
                        "appId": {
                          "type": "string"
                        },
                        "versionId": {
                          "type": "string"
                        },
                        "buildId": {
                          "type": "string"
                        },
                        "targetId": {
                          "type": "string"
                        },
                        "packageName": {
                          "type": "string"
                        },
                        "versionName": {
                          "type": "string"
                        },
                        "versionCode": {
                          "type": "string"
                        },
                        "appName": {
                          "type": "string"
                        },
                        "minSdk": {
                          "type": "string"
                        },
                        "targetSdk": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "icons": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "density": {
                                "type": "string"
                              },
                              "path": {
                                "type": "string"
                              }
                            }
                          }
                        },
                        "manifest": {
                          "type": "object",
                          "properties": {
                            "packageName": {
                              "type": "string"
                            },
                            "versionName": {
                              "type": "string"
                            },
                            "versionCode": {
                              "type": "string"
                            },
                            "minSdk": {
                              "type": "string"
                            },
                            "targetSdk": {
                              "type": "string"
                            },
                            "permissions": {
                              "type": "array",
                              "items": {
                                "type": "string"
                              }
                            },
                            "icon": {
                              "type": "string"
                            }
                          }
                        },
                        "iconBitmap": {
                          "type": "object",
                          "properties": {
                            "path": {
                              "type": "string"
                            },
                            "width": {
                              "type": "number"
                            },
                            "height": {
                              "type": "number"
                            },
                            "sizeBytes": {
                              "type": "number"
                            }
                          }
                        },
                        "targets": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "bundleId": {
                                "type": "string"
                              },
                              "role": {
                                "type": "string"
                              },
                              "platform": {
                                "type": "string"
                              },
                              "version": {
                                "type": "string"
                              },
                              "build": {
                                "type": "string"
                              },
                              "supportedDevices": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              },
                              "orientations": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              },
                              "minOsVersion": {
                                "type": "string"
                              },
                              "iconBitmap": {
                                "type": "object",
                                "properties": {
                                  "path": {
                                    "type": "string"
                                  },
                                  "width": {
                                    "type": "number"
                                  },
                                  "height": {
                                    "type": "number"
                                  },
                                  "sizeBytes": {
                                    "type": "number"
                                  }
                                }
                              },
                              "info": {
                                "type": "object"
                              }
                            }
                          }
                        },
                        "identifier": {
                          "type": "string"
                        },
                        "buildNumber": {
                          "type": "string"
                        },
                        "version": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "501": {
            "description": "Not implemented"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/ingest/upload": {
      "post": {
        "summary": "Upload and ingest build",
        "description": "Returns 400 invalid_archive when the IPA/APK is not a valid zip archive.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                },
                "required": [
                  "file"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Ingested"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/resolve-install": {
      "post": {
        "summary": "Resolve install",
        "description": "For iOS installs, the plist must include a prevalidated HTTPS download URL. The plist itself is not protected, so the IPA URL must be tokenized (local) or pre-signed (S3) and time-limited. Both plist and IPA download URLs require valid HTTPS certificates. For Android AABs, use bundletool with a device spec (ABI, density, language, sdkVersion) to generate device-specific APK sets and enforce the 4 GB compressed APK-set limit.",
        "responses": {
          "200": {
            "description": "Resolver response"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/storage": {
      "get": {
        "summary": "Get storage config",
        "responses": {
          "200": {
            "description": "Storage config"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      },
      "post": {
        "summary": "Set storage config",
        "responses": {
          "200": {
            "description": "Storage config"
          }
        },
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdHeader"
          }
        ]
      }
    },
    "/teams": {
      "get": {
        "summary": "List teams",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      },
      "post": {
        "summary": "Create team",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/teams/{teamId}": {
      "get": {
        "summary": "Get team",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "patch": {
        "summary": "Update team",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          }
        }
      }
    },
    "/teams/{teamId}/users": {
      "get": {
        "summary": "List team users",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      },
      "post": {
        "summary": "Add team user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/teams/{teamId}/users/{userId}": {
      "patch": {
        "summary": "Update team user role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          }
        }
      },
      "delete": {
        "summary": "Remove team user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "userId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Removed"
          }
        }
      }
    },
    "/teams/{teamId}/select": {
      "post": {
        "summary": "Select active team",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/teams/{teamId}/inbox": {
      "get": {
        "summary": "Get team inbox address",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "teamId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/user-team-settings/{key}": {
      "get": {
        "summary": "Get user team setting",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "put": {
        "summary": "Upsert user team setting",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  }
}
